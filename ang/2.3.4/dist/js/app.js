"use strict";angular.module("CountriesApp",["ngRoute"]),angular.module("CountriesApp").constant("GEONAMES_USERNAME","tnowalk"),angular.module("CountriesApp").run(["$rootScope","$location",function(n,t){n.$on("$routeChangeError",function(){t.path("/404")})}]),angular.module("CountriesApp").config(["$routeProvider",function(n){n.when("/",{templateUrl:"js/home/home.html"}).when("/404",{template:"<p>Error - Page Not Found</p>"}).otherwise("/404")}]),angular.module("CountriesApp").config(["$routeProvider",function(n){n.when("/countries",{templateUrl:"js/countries/countries.html",controller:"CountriesCtrl"})}]),angular.module("CountriesApp").factory("CountriesFactory",["$q","$http","GEONAMES_USERNAME",function(n,t,o){var e={endpoint:"http://api.geonames.org/countryInfoJSON",cache:null,get:function(){if(!e.cache){var r={params:{username:o}};return t.get(e.endpoint,r).then(function(n){return e.cache=n.data.geonames,e.cache})}var a=n.defer();return a.resolve(e.cache),a.promise}};return e}]),angular.module("CountriesApp").controller("CountriesCtrl",["$scope","$location","CountriesFactory",function(n,t,o){n.loading=!0,o.get().then(function(t){n.countries=t,n.loading=!1}),n.goToCountry=function(n){n.countryCode&&t.path("/countries/"+n.countryCode+"/capital")}}]),angular.module("CountriesApp").config(["$routeProvider",function(n){n.when("/countries/:id/capital",{templateUrl:"js/country/country.html",controller:"CountryCtrl"})}]),angular.module("CountriesApp").factory("CountryFactory",["$http","GEONAMES_USERNAME",function(n,t){var o={endpoints:{country:"http://api.geonames.org/countryInfoJSON",search:"http://api.geonames.org/search",neighbors:"http://api.geonames.org/neighbours",flag:"http://www.geonames.org/flags/x/{%s}.gif",map:"http://www.geonames.org/img/country/250/{%s}.png"},get:function(e){var r={params:{username:t,country:e}};return n.get(o.endpoints.country,r).then(function(n){return n.data.geonames[0]})},capital:function(e,r){var a={params:{username:t,q:r,name_equals:r,country:e,isNameRequired:!0,type:"JSON"}};return n.get(o.endpoints.search,a).then(function(n){return n.data.geonames[0]})},neighbors:function(e){var r={params:{username:t,geonameId:e,type:"JSON"}};return n.get(o.endpoints.neighbors,r).then(function(n){return n.data.geonames})},flag:function(n){return n?o.endpoints.flag.replace("{%s}",n.toLowerCase()):void 0},map:function(n){return n?o.endpoints.map.replace("{%s}",n.toUpperCase()):void 0}};return o}]),angular.module("CountriesApp").controller("CountryCtrl",["$scope","$q","$location","$route","CountryFactory",function(n,t,o,e,r){n.loading=!0,r.get(e.current.params.id).then(function(o){n.country=o;var e=[];e.push(r.capital(o.countryCode,o.capital)),e.push(r.neighbors(o.geonameId)),t.all(e).then(function(t){n.capital=t[0],n.neighbors=t[1],n.loading=!1})}),n.goToCountry=function(n){n.countryCode&&o.path("/countries/"+n.countryCode+"/capital")},n.flag=r.flag,n.map=r.map}]);